<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Joshua Schwab" />

<meta name="date" content="2020-03-13" />

<title>Introduction to ltmle()</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to ltmle()</h1>
<h4 class="author">Joshua Schwab</h4>
<h4 class="date">2020-03-13</h4>



<div id="minimal-example" class="section level2">
<h2>Minimal Example</h2>
<p>Consider the observed data with time ordering W -&gt; A -&gt; Y. W is a continuous baseline covariate that affects A and Y. A is a binary treatment variable that affects Y. Y is a binary outcome variable.</p>
<p>W ~ N(0, 1)</p>
<p>A ~ binomial with P(A = 1) = expit(W)</p>
<p>Y ~ binomial with P(Y = 1) = expit(W + A)</p>
<p>where <span class="math inline">\(expit(z) = \frac{1}{1 + e^{-z}}\)</span></p>
<p>We want to know <span class="math inline">\(E[Y_1]\)</span> the expected value of Y, intervening to set A to 1.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">rexpit &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">rbinom</span>(<span class="dt">n=</span><span class="kw">length</span>(x), <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="kw">plogis</span>(x))</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A, Y)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">head</span>(data)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt;             W A Y</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt; 1 -1.00576427 1 0</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt; 2 -0.16776940 0 0</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; 3 -0.47677696 1 1</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; 4 -0.43573417 0 0</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; 5  0.35557205 0 1</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; 6  0.02219503 1 1</span></a></code></pre></div>
<p>We could try to use the simple mean of Y or the mean of Y when A = 1, but these will be biased.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">mean</span>(Y)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; [1] 0.5954</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">mean</span>(Y[A <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; [1] 0.7717826</span></a></code></pre></div>
<p>Now we use <code>ltmle()</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; Q.kplus1 ~ W + A</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; A ~ W</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">result</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1)</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; TMLE Estimate:  0.6954446</span></a></code></pre></div>
<p>Because we’re using simulated data, we can calculate the true value of <span class="math inline">\(E[Y_1]\)</span></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">n.large &lt;-<span class="st"> </span><span class="fl">1e6</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n.large)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">A &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">mean</span>(Y)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; [1] 0.696219</span></a></code></pre></div>
</div>
<div id="single-time-point" class="section level2">
<h2>Single time point</h2>
<p>Time ordering of data is W1 -&gt; W2 -&gt; W3 -&gt; A -&gt; Y</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">W1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">W2 &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">prob=</span><span class="fl">0.3</span>)   </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">W3 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>W1 <span class="op">+</span><span class="st"> </span>W3)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="fl">0.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>W1<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>W2 <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>A <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>W3 <span class="op">*</span><span class="st"> </span>A <span class="op">-</span><span class="st"> </span><span class="fl">1.1</span> <span class="op">*</span><span class="st"> </span>W3)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W1, W2, W3, A, Y)</a></code></pre></div>
<p>True value of <span class="math inline">\(E[Y_1]\)</span> is approximately 0.5939.</p>
<p>SuperLearner semiparametric estimation using all parents as regressors</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="co">#&gt; Loading required namespace: SuperLearner</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co">#&gt; A ~ W1 + W2 + W3</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co">#&gt; Loading required package: nnls</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="co">#&gt; Loading required namespace: arm</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a></code></pre></div>
<p>TMLE estimate:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;    Parameter Estimate:  0.62675 </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;     Estimated Std Err:  0.044853 </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;     95% Conf Interval: (0.53884, 0.71466)</span></a></code></pre></div>
<p>IPTW estimate:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">summary</span>(result, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; Estimator:  iptw </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#&gt;    Parameter Estimate:  0.61209 </span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="co">#&gt;     Estimated Std Err:  0.042995 </span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt;     95% Conf Interval: (0.52782, 0.69636)</span></a></code></pre></div>
<p>SuperLearner semiparametric estimation using correctly specified regressors. This passes W1^2, W2, W3, A and W3:A as columns of matrix X to SuperLearner for the Q regression and W1 and W3 as columns of matrix X to SuperLearner for the g regression.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">Y=</span><span class="st">&quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;</span>), </a>
<a class="sourceLine" id="cb9-3" data-line-number="3">                <span class="dt">gform=</span><span class="st">&quot;A ~ W1 + W3&quot;</span>, <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt; Estimate of time to completion: 1 minute</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt;     Qform = c(Y = &quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;), gform = &quot;A ~ W1 + W3&quot;, </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt;     abar = 1, SL.library = &quot;default&quot;)</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt;    Parameter Estimate:  0.61225 </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt;     Estimated Std Err:  0.032859 </span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;     95% Conf Interval: (0.54785, 0.67666)</span></a></code></pre></div>
<p>glm using correctly specified Qform and gform</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, </a>
<a class="sourceLine" id="cb10-2" data-line-number="2"> <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">Y=</span><span class="st">&quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;</span>), <span class="dt">gform=</span><span class="st">&quot;A ~ W1 + W3&quot;</span>, </a>
<a class="sourceLine" id="cb10-3" data-line-number="3"> <span class="dt">abar=</span><span class="dv">1</span>, <span class="dt">SL.library=</span><span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;     Qform = c(Y = &quot;Q.kplus1 ~ I(W1^2) + W2 + W3*A&quot;), gform = &quot;A ~ W1 + W3&quot;, </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;     abar = 1, SL.library = NULL)</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;    Parameter Estimate:  0.61352 </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;     Estimated Std Err:  0.032575 </span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;     95% Conf Interval: (0.54967, 0.67736)</span></a></code></pre></div>
<p>Get summary measures (additive treatment effect, odds ratio, relative risk) for abar=1 vs abar=0</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Lnodes=</span><span class="ot">NULL</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, </a>
<a class="sourceLine" id="cb11-2" data-line-number="2">                      <span class="dt">abar=</span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="dt">SL.library=</span><span class="st">&quot;default&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; Q.kplus1 ~ W1 + W2 + W3 + A</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; A ~ W1 + W2 + W3</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; prediction from a rank-deficient fit may be misleading</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Lnodes = NULL, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;     abar = list(1, 0), SL.library = &quot;default&quot;)</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt; Treatment Estimate:</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt;    Parameter Estimate:  0.62675 </span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt;     Estimated Std Err:  0.044989 </span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;     95% Conf Interval: (0.53858, 0.71493) </span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt; Control Estimate:</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt;    Parameter Estimate:  0.66871 </span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt;     Estimated Std Err:  0.028203 </span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt;     95% Conf Interval: (0.61344, 0.72399) </span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt; Additive Treatment Effect:</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt;    Parameter Estimate:  -0.041957 </span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt;     Estimated Std Err:  0.053098 </span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt;               p-value:  0.42942 </span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">#&gt;     95% Conf Interval: (-0.14603, 0.062113) </span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="co">#&gt; Relative Risk:</span></a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co">#&gt;    Parameter Estimate:  0.93726 </span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40"><span class="co">#&gt;   Est Std Err log(RR):  0.083254 </span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="co">#&gt;               p-value:  0.43638 </span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="co">#&gt;     95% Conf Interval: (0.79614, 1.1034) </span></a>
<a class="sourceLine" id="cb11-43" data-line-number="43"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co">#&gt; Odds Ratio:</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45"><span class="co">#&gt;    Parameter Estimate:  0.8319 </span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46"><span class="co">#&gt;   Est Std Err log(OR):  0.23063 </span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47"><span class="co">#&gt;               p-value:  0.42487 </span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co">#&gt;     95% Conf Interval: (0.52936, 1.3073)</span></a></code></pre></div>
</div>
<div id="censoring" class="section level2">
<h2>Censoring</h2>
<p>Time ordering of data is W -&gt; C -&gt; Y. C is a censoring node. The parameter of interest is Y, intervening to set C to be uncensored. Censoring nodes are very similar to treatment nodes. The main difference is that after censoring, other data is expected to be NA. It is assumed that the parameter of interest always intervenes to set censoring nodes to uncensored, so this is not specified in <code>abar</code>. g and Q regressions always stratify on censoring nodes, whereas g and Q regressions can either stratify or pool over treatment nodes (by using the <code>stratify</code> argument.)</p>
<p>Censoring nodes in <code>data</code> should be factors with two levels - “censored” and “uncensored”. The utility function <code>BinaryToCensoring</code> can be used to facilitate this.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">C &lt;-<span class="st"> </span><span class="kw">BinaryToCensoring</span>(<span class="dt">is.censored =</span> <span class="kw">rexpit</span>(W))</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="kw">summary</span>(C)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt;   censored uncensored </span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;      49910      50090</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7">Y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">Y[C <span class="op">==</span><span class="st"> &quot;uncensored&quot;</span>] &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W[C <span class="op">==</span><span class="st"> &quot;uncensored&quot;</span>])</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, C, Y)</a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="kw">head</span>(data, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;             W          C  Y</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt; 1  -0.2987284   censored NA</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt; 2   1.8769204 uncensored  1</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt; 3  -0.9733347 uncensored  0</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt; 4  -1.0332095 uncensored  1</span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt; 5   1.1169817   censored NA</span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt; 6   0.7518623   censored NA</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt; 7   0.5282109   censored NA</span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt; 8  -0.6633313 uncensored  0</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; 9  -0.7219888   censored NA</span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt; 10  0.3909210   censored NA</span></a>
<a class="sourceLine" id="cb12-22" data-line-number="22"><span class="co">#&gt; 11 -0.4193815   censored NA</span></a>
<a class="sourceLine" id="cb12-23" data-line-number="23"><span class="co">#&gt; 12 -0.7178721 uncensored  0</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24"><span class="co">#&gt; 13  0.9187818   censored NA</span></a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="co">#&gt; 14  1.7185865   censored NA</span></a>
<a class="sourceLine" id="cb12-26" data-line-number="26"><span class="co">#&gt; 15 -0.4896426   censored NA</span></a>
<a class="sourceLine" id="cb12-27" data-line-number="27"><span class="co">#&gt; 16  1.2803184   censored NA</span></a>
<a class="sourceLine" id="cb12-28" data-line-number="28"><span class="co">#&gt; 17  0.3876463   censored NA</span></a>
<a class="sourceLine" id="cb12-29" data-line-number="29"><span class="co">#&gt; 18  0.1425409   censored NA</span></a>
<a class="sourceLine" id="cb12-30" data-line-number="30"><span class="co">#&gt; 19 -0.4874995 uncensored  0</span></a>
<a class="sourceLine" id="cb12-31" data-line-number="31"><span class="co">#&gt; 20 -0.2747150   censored NA</span></a>
<a class="sourceLine" id="cb12-32" data-line-number="32">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="ot">NULL</span>, <span class="dt">Cnodes =</span> <span class="st">&quot;C&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb12-33" data-line-number="33"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb12-34" data-line-number="34"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb12-35" data-line-number="35"><span class="co">#&gt; Q.kplus1 ~ W</span></a>
<a class="sourceLine" id="cb12-36" data-line-number="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-37" data-line-number="37"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb12-38" data-line-number="38"><span class="co">#&gt; formula for C:</span></a>
<a class="sourceLine" id="cb12-39" data-line-number="39"><span class="co">#&gt; C ~ W</span></a>
<a class="sourceLine" id="cb12-40" data-line-number="40"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-41" data-line-number="41"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb12-42" data-line-number="42"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb12-43" data-line-number="43"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb12-44" data-line-number="44"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb12-45" data-line-number="45"><span class="co">#&gt; ltmle(data = data, Anodes = NULL, Cnodes = &quot;C&quot;, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb12-46" data-line-number="46"><span class="co">#&gt;     abar = NULL)</span></a>
<a class="sourceLine" id="cb12-47" data-line-number="47"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-48" data-line-number="48"><span class="co">#&gt;    Parameter Estimate:  0.50057 </span></a>
<a class="sourceLine" id="cb12-49" data-line-number="49"><span class="co">#&gt;     Estimated Std Err:  0.0023378 </span></a>
<a class="sourceLine" id="cb12-50" data-line-number="50"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb12-51" data-line-number="51"><span class="co">#&gt;     95% Conf Interval: (0.49599, 0.50516)</span></a></code></pre></div>
<p>The naive estimate is biased (the true value is 0.5):</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">mean</span>(data<span class="op">$</span>Y)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co">#&gt; [1] NA</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">mean</span>(data<span class="op">$</span>Y, <span class="dt">na.rm =</span> T)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; [1] 0.4152126</span></a></code></pre></div>
</div>
<div id="longitudinal-data" class="section level2">
<h2>Longitudinal data</h2>
<p>Time ordering of data is W -&gt; A1 -&gt; L -&gt; A2 -&gt; Y. L is time-dependent covariate because it occurs after a treatment (or censoring) variable, A1. We indicate this using the <code>Lnodes</code> argument.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">A1 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">L &lt;-<span class="st"> </span><span class="fl">0.3</span> <span class="op">*</span><span class="st"> </span>W <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">A2 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span>L)</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">-</span><span class="st"> </span><span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>A2)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A1, L, A2, Y)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw">head</span>(data)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt;            W A1           L A2 Y</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; 1 -1.2143715  0 -0.72291649  0 0</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; 2  0.2368600  1  0.57968819  1 0</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; 3 -0.7370930  0  0.35485803  0 1</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; 4  0.3061751  1  0.20143846  1 0</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; 5 -0.7264741  0 -0.08946743  0 0</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; 6 -1.2620376  0  0.12865984  0 0</span></a></code></pre></div>
<p>Treatment regime of interest: set A1 to 0, set A2 to 0</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt; formula for L:</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt; Q.kplus1 ~ W + A1</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt; A1 ~ W</span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt; A2 ~ W + A1 + L</span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Lnodes = &quot;L&quot;, Ynodes = &quot;Y&quot;, </span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;     abar = c(0, 0))</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt; TMLE Estimate:  0.5235939</span></a></code></pre></div>
</div>
<div id="longitudinal-data-with-censoring" class="section level2">
<h2>Longitudinal data with censoring</h2>
<p>W -&gt; A1 -&gt; C -&gt; L -&gt; A2 -&gt; Y</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">A1 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">C &lt;-<span class="st"> </span><span class="kw">BinaryToCensoring</span>(<span class="dt">is.censored =</span> <span class="kw">rexpit</span>(<span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>W <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>A1))</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">uncensored &lt;-<span class="st"> </span>C <span class="op">==</span><span class="st"> &quot;uncensored&quot;</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">L &lt;-<span class="st"> </span>A2 &lt;-<span class="st"> </span>Y &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, n)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">L[uncensored] &lt;-<span class="st"> </span>(<span class="fl">0.3</span> <span class="op">*</span><span class="st"> </span>W[uncensored] <span class="op">+</span><span class="st"> </span><span class="fl">0.2</span> <span class="op">*</span><span class="st"> </span>A1[uncensored] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">sum</span>(uncensored)))</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">A2[uncensored] &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W[uncensored] <span class="op">+</span><span class="st"> </span>A1[uncensored] <span class="op">+</span><span class="st"> </span>L[uncensored])</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">Y[uncensored] &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W[uncensored] <span class="op">-</span><span class="st"> </span><span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>A1[uncensored] <span class="op">+</span><span class="st"> </span>L[uncensored] <span class="op">-</span><span class="st"> </span><span class="fl">0.8</span> <span class="op">*</span><span class="st"> </span>A2[uncensored])</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A1, C, L, A2, Y)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="kw">head</span>(data)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt;             W A1          C         L A2  Y</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; 1  0.75424772  1   censored        NA NA NA</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; 2 -0.58126094  1 uncensored -1.491608  0  0</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; 3  0.03526288  0   censored        NA NA NA</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; 4 -1.56066276  0   censored        NA NA NA</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; 5  0.66095190  1   censored        NA NA NA</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; 6 -0.04221528  0 uncensored -1.907210  1  0</span></a></code></pre></div>
<p>Treatment regime of interest: set A1 to 1, set A2 to 0, set C to uncensored:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Cnodes =</span> <span class="st">&quot;C&quot;</span>, <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; formula for L:</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="co">#&gt; Q.kplus1 ~ W + A1</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="co">#&gt; A1 ~ W</span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="co">#&gt; formula for C:</span></a>
<a class="sourceLine" id="cb17-12" data-line-number="12"><span class="co">#&gt; C ~ W + A1</span></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="co">#&gt; A2 ~ W + A1 + L</span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb17-18" data-line-number="18"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Cnodes = &quot;C&quot;, Lnodes = &quot;L&quot;, </span></a>
<a class="sourceLine" id="cb17-19" data-line-number="19"><span class="co">#&gt;     Ynodes = &quot;Y&quot;, abar = c(1, 0))</span></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb17-21" data-line-number="21"><span class="co">#&gt; TMLE Estimate:  0.5521191</span></a></code></pre></div>
</div>
<div id="dynamic-treatment" class="section level2">
<h2>Dynamic treatment</h2>
<p>Treatment regime of interest is: Always treat at time 1 (A1 = 1), treat at at time 2 (A2 = 1) if L &gt; 0</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">abar &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dt">nrow=</span>n, <span class="dt">ncol=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">abar[, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">abar[, <span class="dv">2</span>] &lt;-<span class="st"> </span>L <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">result.abar &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Cnodes =</span> <span class="st">&quot;C&quot;</span>, <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar=</span>abar)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; formula for L:</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; Q.kplus1 ~ W + A1</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; A1 ~ W</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="co">#&gt; formula for C:</span></a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; C ~ W + A1</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co">#&gt; A2 ~ W + A1 + L</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21">result.abar</a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Cnodes = &quot;C&quot;, Lnodes = &quot;L&quot;, </span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24"><span class="co">#&gt;     Ynodes = &quot;Y&quot;, abar = abar)</span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb18-26" data-line-number="26"><span class="co">#&gt; TMLE Estimate:  0.4048778</span></a></code></pre></div>
<p>The regime can also be specified as a <code>rule</code> function. <code>rule</code> is a function applied to each row of <code>data</code> which returns a numeric vector of the same length as <code>Anodes</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">rule &lt;-<span class="st"> </span><span class="cf">function</span>(row) <span class="kw">c</span>(<span class="dv">1</span>, row[<span class="st">&quot;L&quot;</span>] <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">result.rule &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="dt">Cnodes =</span> <span class="st">&quot;C&quot;</span>, <span class="dt">Lnodes=</span><span class="st">&quot;L&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">rule=</span>rule)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt; formula for L:</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt; Q.kplus1 ~ W + A1</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt; Q.kplus1 ~ W + A1 + L + A2</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt; A1 ~ W</span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt; formula for C:</span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt; C ~ W + A1</span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt; A2 ~ W + A1 + L</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19">result.rule</a>
<a class="sourceLine" id="cb19-20" data-line-number="20"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb19-21" data-line-number="21"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Cnodes = &quot;C&quot;, Lnodes = &quot;L&quot;, </span></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"><span class="co">#&gt;     Ynodes = &quot;Y&quot;, rule = rule)</span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb19-24" data-line-number="24"><span class="co">#&gt; TMLE Estimate:  0.4048778</span></a></code></pre></div>
<p>Specfifying the regime using <code>abar</code> and using <code>rule</code> give the same result:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">summary</span>(result.abar)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Cnodes = &quot;C&quot;, Lnodes = &quot;L&quot;, </span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5"><span class="co">#&gt;     Ynodes = &quot;Y&quot;, abar = abar)</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;    Parameter Estimate:  0.40488 </span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;     Estimated Std Err:  0.042302 </span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt;     95% Conf Interval: (0.32197, 0.48779)</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="kw">summary</span>(result.rule)</a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt; ltmle(data = data, Anodes = c(&quot;A1&quot;, &quot;A2&quot;), Cnodes = &quot;C&quot;, Lnodes = &quot;L&quot;, </span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt;     Ynodes = &quot;Y&quot;, rule = rule)</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt;    Parameter Estimate:  0.40488 </span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt;     Estimated Std Err:  0.042302 </span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb20-20" data-line-number="20"><span class="co">#&gt;     95% Conf Interval: (0.32197, 0.48779)</span></a></code></pre></div>
</div>
<div id="variance-estimation" class="section level2">
<h2>Variance estimation</h2>
<p>Consider a simple point treatment problem with observed data <span class="math inline">\(W, A, Y\)</span>. But there is a positivity problem - for small values of <span class="math inline">\(W\)</span>, <span class="math inline">\(Prob(A = 1)\)</span> is very small.</p>
<p>The true parameter value, <span class="math inline">\(E[Y_1]\)</span> is approximately 0.697.</p>
<p>The true TMLE standard deviation (the standard deviation of the TMLE estimate if we ran it many times on many sets of data) is approximately 0.056.</p>
<p>The true IPTW standard deviation (the standard deviation of the IPTW estimate if we ran it many times on many sets of data) is approximately 0.059.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">W &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="dv">4</span> <span class="op">*</span><span class="st"> </span>W)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(W <span class="op">+</span><span class="st"> </span>A)</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W, A, Y)</a></code></pre></div>
<p>The default <code>variance.method</code> is <code>&quot;tmle&quot;</code> - use TMLE in order to approximate the variance of the TMLE estimator. The estimated standard deviation is close to the true TMLE standard deviation.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">r1 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(df, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; Q.kplus1 ~ W + A</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; A ~ W</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="kw">print</span>(<span class="kw">summary</span>(r1))</a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE)</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="co">#&gt;    Parameter Estimate:  0.67782 </span></a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt;     Estimated Std Err:  0.057989 </span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co">#&gt;     95% Conf Interval: (0.56417, 0.79148)</span></a></code></pre></div>
<p>If <code>variance.method</code> is <code>&quot;ic&quot;</code>, variance is estimated using the estimated Influence Curve. This is fast to compute, but may be significantly anticonservative in data with positivity violations.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">r2 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(df, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb23-2" data-line-number="2"> <span class="dt">variance.method=</span><span class="st">&quot;ic&quot;</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">#&gt; Q.kplus1 ~ W + A</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="co">#&gt; A ~ W</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co">#&gt; based on influence curve only, which may be significantly anticonservative</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="co">#&gt; because your data appears to contain positivity violations. It is recommended</span></a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="co">#&gt; to use variance.method='tmle' or variance.method='iptw' to obtain a more</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="co">#&gt; robust variance estimate (but run time may be significantly longer). See</span></a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="co">#&gt; variance.method details in ?ltmle</span></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="kw">print</span>(<span class="kw">summary</span>(r2))</a>
<a class="sourceLine" id="cb23-18" data-line-number="18"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb23-19" data-line-number="19"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb23-20" data-line-number="20"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE, </span></a>
<a class="sourceLine" id="cb23-21" data-line-number="21"><span class="co">#&gt;     variance.method = &quot;ic&quot;)</span></a>
<a class="sourceLine" id="cb23-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb23-23" data-line-number="23"><span class="co">#&gt;    Parameter Estimate:  0.67782 </span></a>
<a class="sourceLine" id="cb23-24" data-line-number="24"><span class="co">#&gt;     Estimated Std Err:  0.037042 </span></a>
<a class="sourceLine" id="cb23-25" data-line-number="25"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb23-26" data-line-number="26"><span class="co">#&gt;     95% Conf Interval: (0.60522, 0.75042)</span></a></code></pre></div>
<p>If <code>variance.method</code> is <code>&quot;iptw&quot;</code>, then use <em>IPTW</em> in order to approximate the variance of the <em>TMLE</em> estimator. This is faster to compute than <code>variance.method = &quot;tmle&quot;</code> but less accurate (and slower to compute than <code>variance.method = &quot;ic&quot;</code> but more accurate).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">r3 &lt;-<span class="st"> </span><span class="kw">ltmle</span>(df, <span class="dt">Anodes=</span><span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes=</span><span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">1</span>, <span class="dt">estimate.time=</span><span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb24-2" data-line-number="2"> <span class="dt">variance.method=</span><span class="st">&quot;iptw&quot;</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; Q.kplus1 ~ W + A</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; A ~ W</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"><span class="kw">print</span>(<span class="kw">summary</span>(r3))</a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb24-14" data-line-number="14"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE, </span></a>
<a class="sourceLine" id="cb24-15" data-line-number="15"><span class="co">#&gt;     variance.method = &quot;iptw&quot;)</span></a>
<a class="sourceLine" id="cb24-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb24-17" data-line-number="17"><span class="co">#&gt;    Parameter Estimate:  0.67782 </span></a>
<a class="sourceLine" id="cb24-18" data-line-number="18"><span class="co">#&gt;     Estimated Std Err:  0.045018 </span></a>
<a class="sourceLine" id="cb24-19" data-line-number="19"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb24-20" data-line-number="20"><span class="co">#&gt;     95% Conf Interval: (0.58959, 0.76606)</span></a></code></pre></div>
<p>If we use the IPTW estimator, <code>variance.method</code> does not change the estimated standard deviation (it only affects the estimated standard deviation of the TMLE estimator).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">summary</span>(r1, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>))</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co">#&gt; Estimator:  iptw </span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE)</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt;    Parameter Estimate:  0.73313 </span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt;     Estimated Std Err:  0.047001 </span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co">#&gt;     95% Conf Interval: (0.64101, 0.82525)</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="kw">print</span>(<span class="kw">summary</span>(r2, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)) <span class="co">#the same - variance.method only affects TMLE</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11"><span class="co">#&gt; Estimator:  iptw </span></a>
<a class="sourceLine" id="cb25-12" data-line-number="12"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE, </span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="co">#&gt;     variance.method = &quot;ic&quot;)</span></a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt;    Parameter Estimate:  0.73313 </span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="co">#&gt;     Estimated Std Err:  0.047001 </span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb25-19" data-line-number="19"><span class="co">#&gt;     95% Conf Interval: (0.64101, 0.82525)</span></a>
<a class="sourceLine" id="cb25-20" data-line-number="20"><span class="kw">print</span>(<span class="kw">summary</span>(r3, <span class="dt">estimator=</span><span class="st">&quot;iptw&quot;</span>)) <span class="co">#the same - variance.method only affects TMLE</span></a>
<a class="sourceLine" id="cb25-21" data-line-number="21"><span class="co">#&gt; Estimator:  iptw </span></a>
<a class="sourceLine" id="cb25-22" data-line-number="22"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb25-23" data-line-number="23"><span class="co">#&gt; ltmle(data = df, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 1, estimate.time = FALSE, </span></a>
<a class="sourceLine" id="cb25-24" data-line-number="24"><span class="co">#&gt;     variance.method = &quot;iptw&quot;)</span></a>
<a class="sourceLine" id="cb25-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb25-26" data-line-number="26"><span class="co">#&gt;    Parameter Estimate:  0.73313 </span></a>
<a class="sourceLine" id="cb25-27" data-line-number="27"><span class="co">#&gt;     Estimated Std Err:  0.047001 </span></a>
<a class="sourceLine" id="cb25-28" data-line-number="28"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb25-29" data-line-number="29"><span class="co">#&gt;     95% Conf Interval: (0.64101, 0.82525)</span></a></code></pre></div>
<p>We can see that the values of g are very small.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">summary</span>(r1<span class="op">$</span>cum.g)</a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="co">#&gt;        V1         </span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="co">#&gt;  Min.   :0.01000  </span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="co">#&gt;  1st Qu.:0.06621  </span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#&gt;  Median :0.53923  </span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="co">#&gt;  Mean   :0.52195  </span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="co">#&gt;  3rd Qu.:0.95837  </span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="co">#&gt;  Max.   :1.00000</span></a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="kw">summary</span>(r1<span class="op">$</span>cum.g.unbounded)</a>
<a class="sourceLine" id="cb26-10" data-line-number="10"><span class="co">#&gt;        V1           </span></a>
<a class="sourceLine" id="cb26-11" data-line-number="11"><span class="co">#&gt;  Min.   :0.0000019  </span></a>
<a class="sourceLine" id="cb26-12" data-line-number="12"><span class="co">#&gt;  1st Qu.:0.0662084  </span></a>
<a class="sourceLine" id="cb26-13" data-line-number="13"><span class="co">#&gt;  Median :0.5392299  </span></a>
<a class="sourceLine" id="cb26-14" data-line-number="14"><span class="co">#&gt;  Mean   :0.5210000  </span></a>
<a class="sourceLine" id="cb26-15" data-line-number="15"><span class="co">#&gt;  3rd Qu.:0.9583683  </span></a>
<a class="sourceLine" id="cb26-16" data-line-number="16"><span class="co">#&gt;  Max.   :0.9999999</span></a>
<a class="sourceLine" id="cb26-17" data-line-number="17"><span class="kw">head</span>(<span class="kw">data.frame</span>(df, <span class="dt">g =</span> r1<span class="op">$</span>cum.g, <span class="dt">g.unbounded =</span> r1<span class="op">$</span>cum.g.unbounded), <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb26-18" data-line-number="18"><span class="co">#&gt;              W A Y         g  g.unbounded</span></a>
<a class="sourceLine" id="cb26-19" data-line-number="19"><span class="co">#&gt; 1  -1.35648823 0 0 0.0100000 3.409752e-03</span></a>
<a class="sourceLine" id="cb26-20" data-line-number="20"><span class="co">#&gt; 2   1.26884814 1 1 0.9963765 9.963765e-01</span></a>
<a class="sourceLine" id="cb26-21" data-line-number="21"><span class="co">#&gt; 3  -0.37773620 1 0 0.1873937 1.873937e-01</span></a>
<a class="sourceLine" id="cb26-22" data-line-number="22"><span class="co">#&gt; 4   0.94972013 1 1 0.9858499 9.858499e-01</span></a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="co">#&gt; 5  -0.24114949 0 0 0.2932962 2.932962e-01</span></a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">#&gt; 6   1.21533567 1 1 0.9954428 9.954428e-01</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">#&gt; 7   0.14571385 0 0 0.6867324 6.867324e-01</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26"><span class="co">#&gt; 8   0.40461617 1 1 0.8697448 8.697448e-01</span></a>
<a class="sourceLine" id="cb26-27" data-line-number="27"><span class="co">#&gt; 9   0.84557785 1 1 0.9780277 9.780277e-01</span></a>
<a class="sourceLine" id="cb26-28" data-line-number="28"><span class="co">#&gt; 10 -0.02310326 1 1 0.5146515 5.146515e-01</span></a>
<a class="sourceLine" id="cb26-29" data-line-number="29"><span class="co">#&gt; 11  0.37353042 1 1 0.8538312 8.538312e-01</span></a>
<a class="sourceLine" id="cb26-30" data-line-number="30"><span class="co">#&gt; 12 -2.46671406 0 1 0.0100000 2.883257e-05</span></a>
<a class="sourceLine" id="cb26-31" data-line-number="31"><span class="co">#&gt; 13 -0.42082160 0 0 0.1607860 1.607860e-01</span></a>
<a class="sourceLine" id="cb26-32" data-line-number="32"><span class="co">#&gt; 14 -0.13043009 0 1 0.4005665 4.005665e-01</span></a>
<a class="sourceLine" id="cb26-33" data-line-number="33"><span class="co">#&gt; 15 -0.26469350 0 0 0.2727496 2.727496e-01</span></a>
<a class="sourceLine" id="cb26-34" data-line-number="34"><span class="co">#&gt; 16  1.69489974 1 1 0.9994187 9.994187e-01</span></a>
<a class="sourceLine" id="cb26-35" data-line-number="35"><span class="co">#&gt; 17  0.13098866 1 1 0.6729456 6.729456e-01</span></a>
<a class="sourceLine" id="cb26-36" data-line-number="36"><span class="co">#&gt; 18  0.47752803 1 1 0.9013555 9.013555e-01</span></a>
<a class="sourceLine" id="cb26-37" data-line-number="37"><span class="co">#&gt; 19 -1.29563313 0 0 0.0100000 4.425675e-03</span></a>
<a class="sourceLine" id="cb26-38" data-line-number="38"><span class="co">#&gt; 20  1.06440181 1 1 0.9913126 9.913126e-01</span></a></code></pre></div>
</div>
<div id="hierarchical-data-and-the-id-variable" class="section level2">
<h2>Hierarchical data and the id variable</h2>
<p>The <code>id</code> argument can be used to specify hierarchical data, such as people in a household.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">num.households &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">people.in.household &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(num.households, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="kw">length</span>(people.in.household)</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">n &lt;-<span class="st"> </span><span class="kw">sum</span>(people.in.household) </a>
<a class="sourceLine" id="cb27-6" data-line-number="6">n</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="co">#&gt; [1] 2738</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8">W.household &lt;-<span class="st"> </span><span class="kw">rnorm</span>(num.households)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"><span class="kw">length</span>(W.household)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="co">#&gt; [1] 500</span></a>
<a class="sourceLine" id="cb27-11" data-line-number="11">W.household.expanded &lt;-<span class="st"> </span><span class="kw">rep</span>(W.household, <span class="dt">times =</span> people.in.household)</a>
<a class="sourceLine" id="cb27-12" data-line-number="12">W.indiv &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="kw">length</span>(W.indiv)</a>
<a class="sourceLine" id="cb27-14" data-line-number="14"><span class="co">#&gt; [1] 2738</span></a>
<a class="sourceLine" id="cb27-15" data-line-number="15">A &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="fl">1.5</span> <span class="op">*</span><span class="st"> </span>W.household.expanded <span class="op">+</span><span class="st"> </span><span class="fl">0.4</span> <span class="op">*</span><span class="st"> </span>W.indiv)</a>
<a class="sourceLine" id="cb27-16" data-line-number="16">Y &lt;-<span class="st"> </span><span class="kw">rexpit</span>(<span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="fl">2.3</span> <span class="op">*</span><span class="st"> </span>W.household.expanded <span class="op">-</span><span class="st"> </span><span class="fl">0.6</span> <span class="op">*</span><span class="st"> </span>W.indiv <span class="op">+</span><span class="st"> </span><span class="fl">1.2</span> <span class="op">*</span><span class="st"> </span>A)</a></code></pre></div>
<p>id can be an integer, factor, or character (or any type that can be coerced to factor),</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">id &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>num.households </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">id.expanded &lt;-<span class="st"> </span><span class="kw">rep</span>(id, <span class="dt">times =</span> people.in.household)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(W.household.expanded, W.indiv, A, Y)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="kw">head</span>(<span class="kw">cbind</span>(id.expanded, data), <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt;    id.expanded W.household.expanded      W.indiv A Y</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="co">#&gt; 1            1            0.3539016 -0.539311380 1 1</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="co">#&gt; 2            1            0.3539016  0.276729241 0 1</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="co">#&gt; 3            1            0.3539016  0.254790709 1 0</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="co">#&gt; 4            2           -2.2184914 -1.647148651 0 0</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="co">#&gt; 5            2           -2.2184914 -0.007023282 0 0</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="co">#&gt; 6            3            0.1240071  0.309937561 0 0</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="co">#&gt; 7            3            0.1240071  0.500161573 0 0</span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="co">#&gt; 8            3            0.1240071  0.057252323 1 0</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="co">#&gt; 9            3            0.1240071 -1.227004677 0 1</span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="co">#&gt; 10           3            0.1240071  0.741631195 0 0</span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="co">#&gt; 11           4           -1.6185501  0.529298479 0 0</span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="co">#&gt; 12           4           -1.6185501  1.498849852 0 0</span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="co">#&gt; 13           4           -1.6185501 -1.353555069 0 0</span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="co">#&gt; 14           4           -1.6185501  1.808790572 0 0</span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20"><span class="co">#&gt; 15           4           -1.6185501 -0.376653967 0 0</span></a>
<a class="sourceLine" id="cb28-21" data-line-number="21"><span class="co">#&gt; 16           4           -1.6185501  0.672049220 1 0</span></a>
<a class="sourceLine" id="cb28-22" data-line-number="22"><span class="co">#&gt; 17           5            0.1735576 -0.641476699 0 0</span></a>
<a class="sourceLine" id="cb28-23" data-line-number="23"><span class="co">#&gt; 18           5            0.1735576 -1.405063679 1 0</span></a>
<a class="sourceLine" id="cb28-24" data-line-number="24"><span class="co">#&gt; 19           5            0.1735576 -1.268529841 0 1</span></a>
<a class="sourceLine" id="cb28-25" data-line-number="25"><span class="co">#&gt; 20           5            0.1735576 -0.946288370 0 1</span></a></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">result.without.id &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb29-7" data-line-number="7"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8"><span class="co">#&gt; A ~ W.household.expanded + W.indiv</span></a>
<a class="sourceLine" id="cb29-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-10" data-line-number="10"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb29-11" data-line-number="11">result.with.id &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes =</span> <span class="st">&quot;A&quot;</span>, <span class="dt">Ynodes =</span> <span class="st">&quot;Y&quot;</span>, <span class="dt">abar =</span> <span class="dv">0</span>, <span class="dt">id =</span> id.expanded)</a>
<a class="sourceLine" id="cb29-12" data-line-number="12"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb29-13" data-line-number="13"><span class="co">#&gt; formula for Y:</span></a>
<a class="sourceLine" id="cb29-14" data-line-number="14"><span class="co">#&gt; Q.kplus1 ~ W.household.expanded + W.indiv + A</span></a>
<a class="sourceLine" id="cb29-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-16" data-line-number="16"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb29-17" data-line-number="17"><span class="co">#&gt; formula for A:</span></a>
<a class="sourceLine" id="cb29-18" data-line-number="18"><span class="co">#&gt; A ~ W.household.expanded + W.indiv</span></a>
<a class="sourceLine" id="cb29-19" data-line-number="19"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb29-20" data-line-number="20"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a></code></pre></div>
<p>Omitting the id argument makes the individuals seem more independent than they are, which gives artificially low variance estimates.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">summary</span>(result.without.id)</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 0)</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"><span class="co">#&gt;    Parameter Estimate:  0.36207 </span></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co">#&gt;     Estimated Std Err:  0.012771 </span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#&gt;     95% Conf Interval: (0.33704, 0.38711)</span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="kw">summary</span>(result.with.id)</a>
<a class="sourceLine" id="cb30-11" data-line-number="11"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="co">#&gt; ltmle(data = data, Anodes = &quot;A&quot;, Ynodes = &quot;Y&quot;, abar = 0, id = id.expanded)</span></a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15"><span class="co">#&gt;    Parameter Estimate:  0.36207 </span></a>
<a class="sourceLine" id="cb30-16" data-line-number="16"><span class="co">#&gt;     Estimated Std Err:  0.019685 </span></a>
<a class="sourceLine" id="cb30-17" data-line-number="17"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb30-18" data-line-number="18"><span class="co">#&gt;     95% Conf Interval: (0.32349, 0.40066)</span></a></code></pre></div>
<p>The influence curve is a vector with length equal to the number of independent units.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">length</span>(result.without.id<span class="op">$</span>IC<span class="op">$</span>tmle)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co">#&gt; [1] 2738</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw">length</span>(result.with.id<span class="op">$</span>IC<span class="op">$</span>tmle)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="co">#&gt; [1] 500</span></a></code></pre></div>
</div>
<div id="multiple-time-dependent-covariates-and-treatments-at-each-time-point-continuous-y-values" class="section level2">
<h2>Multiple time-dependent covariates and treatments at each time point, continuous Y values</h2>
<p>age -&gt; gender -&gt; A1 -&gt; L1a -&gt; L1b -&gt; Y1 -&gt; A2 -&gt; L2a -&gt; L2b -&gt; Y2</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">age &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">gender &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">A1 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span>gender)</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">L1a &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>age <span class="op">-</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>gender <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">L1b &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>gender <span class="op">-</span><span class="st"> </span>A1)</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">Y1 &lt;-<span class="st"> </span><span class="kw">plogis</span>(age <span class="op">-</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>L1a <span class="op">+</span><span class="st"> </span><span class="fl">0.7</span><span class="op">*</span>L1b <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n))</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">A2 &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>A1 <span class="op">-</span><span class="st"> </span>L1a <span class="op">-</span><span class="st"> </span>L1b)</a>
<a class="sourceLine" id="cb32-9" data-line-number="9">L2a &lt;-<span class="st"> </span><span class="dv">2</span><span class="op">*</span>age <span class="op">-</span><span class="st"> </span><span class="dv">3</span><span class="op">*</span>gender <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>A1 <span class="op">+</span><span class="st"> </span>A2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb32-10" data-line-number="10">L2b &lt;-<span class="st"> </span><span class="kw">rexpit</span>(age <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>gender <span class="op">-</span><span class="st"> </span>A1 <span class="op">-</span><span class="st"> </span>A2)</a>
<a class="sourceLine" id="cb32-11" data-line-number="11">Y2 &lt;-<span class="st"> </span><span class="kw">plogis</span>(age <span class="op">-</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>L1a <span class="op">+</span><span class="st"> </span>L1b <span class="op">+</span><span class="st"> </span>A1 <span class="op">+</span><span class="st"> </span><span class="fl">1.8</span><span class="op">*</span>A2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n))</a>
<a class="sourceLine" id="cb32-12" data-line-number="12">data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(age, gender, A1, L1a, L1b, Y1, A2, L2a, L2b, Y2)</a></code></pre></div>
<p>Also show some different ways of specifying the nodes (either names or indexes works):</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), </a>
<a class="sourceLine" id="cb33-2" data-line-number="2"> <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)) </a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="co">#&gt; Qform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="co">#&gt; formula for L1a:</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="co">#&gt; Q.kplus1 ~ age + gender + A1</span></a>
<a class="sourceLine" id="cb33-6" data-line-number="6"><span class="co">#&gt; formula for L2a:</span></a>
<a class="sourceLine" id="cb33-7" data-line-number="7"><span class="co">#&gt; Q.kplus1 ~ age + gender + A1 + L1a + L1b + Y1 + A2</span></a>
<a class="sourceLine" id="cb33-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb33-9" data-line-number="9"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb33-10" data-line-number="10"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb33-11" data-line-number="11"><span class="co">#&gt; A1 ~ age + gender</span></a>
<a class="sourceLine" id="cb33-12" data-line-number="12"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb33-13" data-line-number="13"><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></a>
<a class="sourceLine" id="cb33-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb33-15" data-line-number="15"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb33-16" data-line-number="16"><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></a>
<a class="sourceLine" id="cb33-17" data-line-number="17"><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></a>
<a class="sourceLine" id="cb33-18" data-line-number="18"><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></a>
<a class="sourceLine" id="cb33-19" data-line-number="19"><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in a</span></a>
<a class="sourceLine" id="cb33-20" data-line-number="20"><span class="co">#&gt; future release.</span></a>
<a class="sourceLine" id="cb33-21" data-line-number="21"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb33-22" data-line-number="22"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb33-23" data-line-number="23"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb33-24" data-line-number="24"><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span></a>
<a class="sourceLine" id="cb33-25" data-line-number="25"><span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), abar = c(1, </span></a>
<a class="sourceLine" id="cb33-26" data-line-number="26"><span class="co">#&gt;     0))</span></a>
<a class="sourceLine" id="cb33-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb33-28" data-line-number="28"><span class="co">#&gt;    Parameter Estimate:  0.82404 </span></a>
<a class="sourceLine" id="cb33-29" data-line-number="29"><span class="co">#&gt;     Estimated Std Err:  0.012936 </span></a>
<a class="sourceLine" id="cb33-30" data-line-number="30"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb33-31" data-line-number="31"><span class="co">#&gt;     95% Conf Interval: (0.79869, 0.8494)</span></a></code></pre></div>
</div>
<div id="specifying-qform" class="section level2">
<h2>Specifying Qform</h2>
<p>Usually you would specify a <code>Qform</code> for all of the Lnodes and Ynodes but in this case L1a, L1b, Y1 is a “block” of L/Y nodes not separated by Anodes or Cnodes (the same is true for L2a, L2b, Y2). Only one regression is required at the first L/Y node in a block. You can pass regression formulas for the other L/Y nodes, but they will be ignored.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), </a>
<a class="sourceLine" id="cb34-2" data-line-number="2"> <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb34-3" data-line-number="3"> <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">L1a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L2a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>))</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="co">#&gt; A1 ~ age + gender</span></a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></a>
<a class="sourceLine" id="cb34-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb34-10" data-line-number="10"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb34-11" data-line-number="11"><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></a>
<a class="sourceLine" id="cb34-12" data-line-number="12"><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></a>
<a class="sourceLine" id="cb34-13" data-line-number="13"><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></a>
<a class="sourceLine" id="cb34-14" data-line-number="14"><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in a</span></a>
<a class="sourceLine" id="cb34-15" data-line-number="15"><span class="co">#&gt; future release.</span></a>
<a class="sourceLine" id="cb34-16" data-line-number="16"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb34-17" data-line-number="17"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb34-18" data-line-number="18"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb34-19" data-line-number="19"><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span></a>
<a class="sourceLine" id="cb34-20" data-line-number="20"><span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), Qform = c(L1a = &quot;Q.kplus1 ~ 1&quot;, </span></a>
<a class="sourceLine" id="cb34-21" data-line-number="21"><span class="co">#&gt;     L2a = &quot;Q.kplus1 ~ 1&quot;), abar = c(1, 0))</span></a>
<a class="sourceLine" id="cb34-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb34-23" data-line-number="23"><span class="co">#&gt;    Parameter Estimate:  0.82977 </span></a>
<a class="sourceLine" id="cb34-24" data-line-number="24"><span class="co">#&gt;     Estimated Std Err:  0.030899 </span></a>
<a class="sourceLine" id="cb34-25" data-line-number="25"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb34-26" data-line-number="26"><span class="co">#&gt;     95% Conf Interval: (0.76921, 0.89033)</span></a></code></pre></div>
<p>Gives the same result but prints a message saying some regression formulas will be dropped:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">result &lt;-<span class="st"> </span><span class="kw">ltmle</span>(data, <span class="dt">Anodes=</span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">7</span>), <span class="dt">Lnodes=</span><span class="kw">c</span>(<span class="st">&quot;L1a&quot;</span>, <span class="st">&quot;L1b&quot;</span>, <span class="st">&quot;L2a&quot;</span>, <span class="st">&quot;L2b&quot;</span>), </a>
<a class="sourceLine" id="cb35-2" data-line-number="2"> <span class="dt">Ynodes=</span><span class="kw">grep</span>(<span class="st">&quot;^Y&quot;</span>, <span class="kw">names</span>(data)), <span class="dt">abar=</span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb35-3" data-line-number="3"> <span class="dt">Qform=</span><span class="kw">c</span>(<span class="dt">L1a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L1b=</span><span class="st">&quot;Q.klus1~A1&quot;</span>, </a>
<a class="sourceLine" id="cb35-4" data-line-number="4"> <span class="dt">Y1=</span><span class="st">&quot;Q.kplus1~L1a&quot;</span>, <span class="dt">L2a=</span><span class="st">&quot;Q.kplus1 ~ 1&quot;</span>, <span class="dt">L2b=</span><span class="st">&quot;Q.klus1~A1&quot;</span>, <span class="dt">Y2=</span><span class="st">&quot;Q.kplus1~A2 + gender&quot;</span>))</a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="co">#&gt; L/Y nodes (after removing blocks)  : L1a L2a</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="co">#&gt; Qform names                        : L1a L1b Y1 L2a L2b Y2</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="co">#&gt; The following nodes are not being considered as L/Y nodes because they are part of a block</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="co">#&gt; of L/Y nodes. They are being dropped from Qform:</span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="co">#&gt; L1b </span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="co">#&gt;  Y1 </span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="co">#&gt;  L2b </span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="co">#&gt;  Y2</span></a>
<a class="sourceLine" id="cb35-13" data-line-number="13"><span class="co">#&gt; gform not specified, using defaults:</span></a>
<a class="sourceLine" id="cb35-14" data-line-number="14"><span class="co">#&gt; formula for A1:</span></a>
<a class="sourceLine" id="cb35-15" data-line-number="15"><span class="co">#&gt; A1 ~ age + gender</span></a>
<a class="sourceLine" id="cb35-16" data-line-number="16"><span class="co">#&gt; formula for A2:</span></a>
<a class="sourceLine" id="cb35-17" data-line-number="17"><span class="co">#&gt; A2 ~ age + gender + A1 + L1a + L1b + Y1</span></a>
<a class="sourceLine" id="cb35-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb35-19" data-line-number="19"><span class="co">#&gt; Estimate of time to completion: &lt; 1 minute</span></a>
<a class="sourceLine" id="cb35-20" data-line-number="20"><span class="co">#&gt; Warning in CheckForVarianceWarning(inputs, g.ratio): Variance estimate is based</span></a>
<a class="sourceLine" id="cb35-21" data-line-number="21"><span class="co">#&gt; on influence curve only, which may be significantly anticonservative because</span></a>
<a class="sourceLine" id="cb35-22" data-line-number="22"><span class="co">#&gt; your data appears to contain positivity violations. Robust variance estimate is</span></a>
<a class="sourceLine" id="cb35-23" data-line-number="23"><span class="co">#&gt; not currently available with non binary outcomes but this will be addressed in a</span></a>
<a class="sourceLine" id="cb35-24" data-line-number="24"><span class="co">#&gt; future release.</span></a>
<a class="sourceLine" id="cb35-25" data-line-number="25"><span class="kw">summary</span>(result)</a>
<a class="sourceLine" id="cb35-26" data-line-number="26"><span class="co">#&gt; Estimator:  tmle </span></a>
<a class="sourceLine" id="cb35-27" data-line-number="27"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb35-28" data-line-number="28"><span class="co">#&gt; ltmle(data = data, Anodes = c(3, 7), Lnodes = c(&quot;L1a&quot;, &quot;L1b&quot;, </span></a>
<a class="sourceLine" id="cb35-29" data-line-number="29"><span class="co">#&gt;     &quot;L2a&quot;, &quot;L2b&quot;), Ynodes = grep(&quot;^Y&quot;, names(data)), Qform = c(L1a = &quot;Q.kplus1 ~ 1&quot;, </span></a>
<a class="sourceLine" id="cb35-30" data-line-number="30"><span class="co">#&gt;     L1b = &quot;Q.klus1~A1&quot;, Y1 = &quot;Q.kplus1~L1a&quot;, L2a = &quot;Q.kplus1 ~ 1&quot;, </span></a>
<a class="sourceLine" id="cb35-31" data-line-number="31"><span class="co">#&gt;     L2b = &quot;Q.klus1~A1&quot;, Y2 = &quot;Q.kplus1~A2 + gender&quot;), abar = c(1, </span></a>
<a class="sourceLine" id="cb35-32" data-line-number="32"><span class="co">#&gt;     0))</span></a>
<a class="sourceLine" id="cb35-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb35-34" data-line-number="34"><span class="co">#&gt;    Parameter Estimate:  0.82977 </span></a>
<a class="sourceLine" id="cb35-35" data-line-number="35"><span class="co">#&gt;     Estimated Std Err:  0.030899 </span></a>
<a class="sourceLine" id="cb35-36" data-line-number="36"><span class="co">#&gt;               p-value:  &lt;2e-16 </span></a>
<a class="sourceLine" id="cb35-37" data-line-number="37"><span class="co">#&gt;     95% Conf Interval: (0.76921, 0.89033)</span></a></code></pre></div>
<p>If there were a Anode or Cnode between L1b and Y1, Y1 would also need a Q regression formula.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
